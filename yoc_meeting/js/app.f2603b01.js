(function(e){function t(t){for(var n,o,i=t[0],u=t[1],c=t[2],d=0,h=[];d<i.length;d++)o=i[d],Object.prototype.hasOwnProperty.call(r,o)&&r[o]&&h.push(r[o][0]),r[o]=0;for(n in u)Object.prototype.hasOwnProperty.call(u,n)&&(e[n]=u[n]);l&&l(t);while(h.length)h.shift()();return a.push.apply(a,c||[]),s()}function s(){for(var e,t=0;t<a.length;t++){for(var s=a[t],n=!0,i=1;i<s.length;i++){var u=s[i];0!==r[u]&&(n=!1)}n&&(a.splice(t--,1),e=o(o.s=s[0]))}return e}var n={},r={app:0},a=[];function o(t){if(n[t])return n[t].exports;var s=n[t]={i:t,l:!1,exports:{}};return e[t].call(s.exports,s,s.exports,o),s.l=!0,s.exports}o.m=e,o.c=n,o.d=function(e,t,s){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(o.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)o.d(s,n,function(t){return e[t]}.bind(null,n));return s},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],u=i.push.bind(i);i.push=t,i=i.slice();for(var c=0;c<i.length;c++)t(i[c]);var l=u;a.push([0,"chunk-vendors"]),s()})({0:function(e,t,s){e.exports=s("56d7")},"2d49":function(e,t,s){"use strict";s("2d4f")},"2d4f":function(e,t,s){},"56d7":function(e,t,s){"use strict";s.r(t);s("44a9"),s("3a99"),s("2c238"),s("6ae4");var n=s("a593"),r=s("6255"),a=s.n(r),o=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticStyle:{height:"100%"},attrs:{id:"app"}},[s("router-view")],1)},i=[],u={components:{},data:function(){return{}},methods:{}},c=u,l=s("5d22"),d=Object(l["a"])(c,o,i,!1,null,"b3c4ecce",null),h=d.exports,p=s("a81e"),v=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("div",{staticStyle:{"margin-top":"20px"}},[s("el-dialog",{attrs:{visible:e.showInfo,title:"Info"},on:{"update:visible":function(t){e.showInfo=t}}},[s("p",[e._v("Please enter your name")]),s("el-input",{model:{value:e.userId,callback:function(t){e.userId=t},expression:"userId"}}),s("div",[s("el-button",{staticStyle:{"margin-top":"20px"},attrs:{type:"primary"},on:{click:e.joinRoom}},[e._v("Join Room")])],1)],1)],1),s("el-button",{attrs:{type:"primary"},on:{click:function(t){e.showInfo=!0}}},[e._v("Join Room")]),s("el-dropdown",{staticStyle:{"margin-left":"10px"},attrs:{trigger:"click",placement:"bottom-start"},on:{"visible-change":e.listRoomUsers}},[s("el-badge",{staticClass:"item",attrs:{value:e.newMessages.length,hidden:0==e.newMessages.length}},[s("el-button",{attrs:{type:"primary"}},[e._v(" Chat"),s("i",{staticClass:"el-icon-arrow-down el-icon--right"})])],1),s("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},e._l(e.userList,(function(t,n){return s("el-dropdown-item",{key:n},[s("el-badge",{staticClass:"item",attrs:{value:e.computeNum(t.userId),hidden:e.computeHidden(t.userId)}},[s("div",{staticStyle:{width:"80px",height:"50px","line-height":"50px"},on:{click:function(s){return e.initChat(t.userId)}}},[e._v(e._s(t.userId))])])],1)})),1)],1),"admin"==e.userId?s("el-button",{staticStyle:{"margin-left":"20px"},attrs:{type:"primary"},on:{click:function(t){e.showSend=!0}}},[e._v("Post")]):e._e(),s("el-dialog",{attrs:{visible:e.showChat},on:{"update:visible":function(t){e.showChat=t},close:e.removeMessage}},[s("div",{staticClass:"chatBlock"},e._l(e.chatMessage,(function(t,n){return s("div",{key:n,staticStyle:{height:"50px","line-height":"50px","margin-top":"10px"}},[s("div",{class:t.userId==e.userId?"right":"left"},[s("span",{staticStyle:{background:"rgba(64,158,255,0.3)","border-radius":"20px",padding:"10px 16px"}},[e._v(e._s(t.data))])])])})),0),s("div",{staticStyle:{"margin-top":"20px"}},[s("el-input",{staticStyle:{width:"86%"},model:{value:e.message,callback:function(t){e.message=t},expression:"message"}}),s("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary"},on:{click:e.sendMessage}},[e._v("Send")])],1)]),s("div",{staticClass:"users"},[s("p",{staticStyle:{color:"#606266"}},[e._v("Local")]),s("div",{staticStyle:{width:"320px"},attrs:{id:"localvideo"}}),"admin"==e.userId?s("p",{staticStyle:{"margin-top":"30px",color:"#606266"}},[e._v("Meeting")]):e._e(),s("div",{attrs:{id:"remote"}})]),s("el-dialog",{attrs:{visible:e.showSend,title:"Send"},on:{"update:visible":function(t){e.showSend=t}}},[s("el-input",{model:{value:e.messageAll,callback:function(t){e.messageAll=t},expression:"messageAll"}}),s("el-button",{on:{click:e.sendAll}},[e._v("Send")])],1)],1)},f=[],m=(s("bf00"),s("8601"),s("bc4a"),s("85a2"),s("1377")),g=(s("6a61"),s("2e91")),b=s("0c68"),y=s("82ae"),I=s.n(y),w=I.a.create({baseURL:"./index.php",timeout:5e3}),M=w;function x(){return M.post("./index.php",{function:"listActiveRooms"})}function S(e,t,s){return M.post("./index.php",{function:"createRoomToken",room:e,userId:t,type:s})}function k(e){return M.post("./index.php",{function:"listRoomUsers",room:e})}var _=new b["StreamModeSession"];console.log("current version is",b["version"]);var C={data:function(){return{audioDevice:"",videoDevice:"",audioDevices:[],videoDevices:[],roomToken:"",userList:[],currentUser:"",lastUser:"",showInfo:!1,showToken:!1,showSend:!1,room:"",userId:"",userToken:"",room_list:[],type:"",currentRoom:"",message:"",toUserId:"",showChat:!1,chatMessage:[],allMessages:{},newMessages:[],messageAll:""}},mounted:function(){var e=this;this.listActiveRooms(),b["deviceManager"].deviceInfo&&this.addDeviceToSelect(b["deviceManager"].deviceInfo),b["deviceManager"].on("device-update",(function(t){e.addDeviceToSelect(t)}))},methods:{addDeviceToSelect:function(e){var t=[],s=[];e.forEach((function(e){"audioinput"===e.kind?t.push(e):"videoinput"===e.kind&&s.push(e)})),this.audioDevices=t,this.videoDevices=s},joinRoom:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var s,n,r,a,o,i,u,c,l;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.showInfo=!1,t.next=3,e.createRoomToken();case 3:return s=t.sent,t.prev=4,t.next=7,_.joinRoomWithToken(s);case 7:if(n=t.sent,"admin"==e.userId){r=Object(m["a"])(n);try{for(r.s();!(a=r.n()).done;)o=a.value,o.userId!==_.userId&&o.published&&(i=document.createElement("div"),u=document.createElement("div"),c=document.createElement("div"),i.appendChild(u),i.appendChild(c),c.style.height="50px",c.style.color="#606266",c.style.textAlign="center",c.innerHTML=o.userId,u.setAttribute("id",o.userId),u.style.width="320px",l=document.getElementById("remote"),l.appendChild(i),e.subscribeUser(o.userId,o.userId))}catch(d){r.e(d)}finally{r.f()}}t.next=16;break;case 11:return t.prev=11,t.t0=t["catch"](4),console.error(t.t0),alert("Join Failed！ErrorCode: ".concat(t.t0.code||"")),t.abrupt("return");case 16:return _.on("user-publish",(function(t){if("admin"==e.userId){var s=document.createElement("div"),n=document.createElement("div"),r=document.createElement("div");s.appendChild(n),s.appendChild(r),r.style.height="50px",r.innerHTML=t.userId,r.style.textAlign="center",r.style.color="#606266",n.setAttribute("id",t.userId),n.style.width="320px";var a=document.getElementById("remote");a.appendChild(s),e.subscribeUser(t.userId,t.userId)}})),_.on("messages-received",(function(t){if(void 0!==e.allMessages[t[0].userId]){var s=e.allMessages[t[0].userId];s.push(t[0]),e.allMessages[t[0].userId]=s}else{e.allMessages[t[0].userId]=[];var n=e.allMessages[t[0].userId];n.push(t[0]),e.allMessages[t[0].userId]=n}if(e.updateMessage(),t[0].userId==e.toUserId&&1==e.showChat);else{var r=e.newMessages;r.push(t[0]),e.newMessages=r}})),_.on("user-join",(function(t){e.$message({message:t.userId+"comming~",type:"success"})})),t.next=21,e.publish(_);case 21:case"end":return t.stop()}}),t,null,[[4,11]])})))()},updateMessage:function(){this.chatMessage=this.allMessages[this.toUserId]},publishScreen:function(){return Object(g["a"])(regeneratorRuntime.mark((function e(){var t,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,b["deviceManager"].getLocalStream({screen:{enabled:!0,source:"window",bitrate:600,height:1080,width:1920},audio:{enabled:!1}});case 3:t=e.sent,e.next=11;break;case 6:return e.prev=6,e.t0=e["catch"](0),console.error(e.t0),alert("Please check your device。ErrorCode: ".concat(e.t0.code)),e.abrupt("return");case 11:return s=document.getElementById("localvideo"),t.play(s,!0),e.prev=13,e.next=16,_.publish(t);case 16:e.next=22;break;case 18:e.prev=18,e.t1=e["catch"](13),console.error(e.t1),alert("Fail，ErrorCode: ".concat(e.t1.code));case 22:case"end":return e.stop()}}),e,null,[[0,6],[13,18]])})))()},publish:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var s,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,b["deviceManager"].getLocalStream({video:{enabled:!0,deviceId:e.videoDevice,bitrate:1e3,height:480,width:640},audio:{enabled:!1,deviceId:e.audioDevice}});case 3:s=t.sent,t.next=11;break;case 6:return t.prev=6,t.t0=t["catch"](0),console.error(t.t0),alert("Please check your device。ErrorCode: ".concat(t.t0.code)),t.abrupt("return");case 11:return n=document.getElementById("localvideo"),s.play(n,!0),t.prev=13,t.next=16,_.publish(s);case 16:t.next=22;break;case 18:t.prev=18,t.t1=t["catch"](13),console.error(t.t1),alert("Fail，ErrorCode: ".concat(t.t1.code));case 22:case"end":return t.stop()}}),t,null,[[0,6],[13,18]])})))()},subscribeUser:function(e,t){var s=document.getElementById(t);_.subscribe(e).then((function(e){e.play(s)}))},listActiveRooms:function(){var e=this;x().then((function(t){e.room_list=t.data.rooms}))},createRoomToken:function(){var e=this;return new Promise((function(t,s){e.room="test",S(e.room,e.userId,"user").then((function(e){t(e.data.data)}))}))},listRoomUsers:function(e){var t=this;e&&""!==this.room&&k("test").then((function(e){if("admin"!==t.userId){var s=e.data.users.filter((function(e){return"admin"==e.userId}));t.userList=s}else{var n=e.data.users.filter((function(e){return"admin"!==e.userId}));t.userList=n}}))},changeView:function(){var e,t=Object(m["a"])(this.userList);try{for(t.s();!(e=t.n()).done;){var s=e.value;s.userId==this.currentUser?_.setMergeStreamLayout(this.currentUser,{x:0,y:0,w:1920,h:1080,hidden:!1,muted:!1}):_.setMergeStreamLayout(s.userId,{x:0,y:0,w:0,h:0,hidden:!1,muted:!1})}}catch(n){t.e(n)}finally{t.f()}},stopView:function(){_.stopMergeStream()},initChat:function(e){var t=this;this.toUserId=e,this.message="",this.showChat=!0,console.log(this.allMessages),this.allMessages[e]?this.chatMessage=this.allMessages[e]:this.chatMessage=[];var s=this.newMessages.filter((function(e){return e.userId!==t.toUserId}));this.newMessages=s},sendMessage:function(){_.sendCustomMessage(this.message,[this.toUserId]);var e={data:this.message,type:"normal",userId:this.userId};if(this.allMessages[this.toUserId]){var t=this.allMessages[this.toUserId];t.push(e),this.allMessages[this.toUserId]=t}else{this.allMessages[this.toUserId]=[];var s=this.allMessages[this.toUserId];s.push(e),this.allMessages[this.toUserId]=s}this.updateMessage()},removeMessage:function(){this.chatMessage=[]},computeNum:function(e){var t=[];return t=this.newMessages.filter((function(t){return t.userId==e})),t.length},computeHidden:function(e){var t=[];return t=this.newMessages.filter((function(t){return t.userId==e})),0==t.length},sendAll:function(){_.sendCustomMessage(this.messageAll),this.showSend=!1}}},U=C,R=(s("2d49"),Object(l["a"])(U,v,f,!1,null,null,null)),j=R.exports;n["default"].use(p["a"]);var E=p["a"].prototype.push;p["a"].prototype.push=function(e){return E.call(this,e).catch((function(e){return e}))};var O=new p["a"]({routes:[{path:"/",component:j}]}),T=O,A=(s("a675"),s("9f35"),s("cf6b")),L=s("ea5a");n["default"].use(A["a"]);var P=new A["a"].Store({state:{},mutations:{},plugins:[Object(L["a"])()]}),D=P;n["default"].config.productionTip=!1,n["default"].use(a.a),new n["default"]({router:T,store:D,render:function(e){return e(h)}}).$mount("#app")}});
//# sourceMappingURL=app.f2603b01.js.map