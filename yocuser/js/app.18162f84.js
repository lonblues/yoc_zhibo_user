(function(e){function t(t){for(var n,a,c=t[0],s=t[1],u=t[2],l=0,p=[];l<c.length;l++)a=c[l],Object.prototype.hasOwnProperty.call(o,a)&&o[a]&&p.push(o[a][0]),o[a]=0;for(n in s)Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n]);d&&d(t);while(p.length)p.shift()();return i.push.apply(i,u||[]),r()}function r(){for(var e,t=0;t<i.length;t++){for(var r=i[t],n=!0,c=1;c<r.length;c++){var s=r[c];0!==o[s]&&(n=!1)}n&&(i.splice(t--,1),e=a(a.s=r[0]))}return e}var n={},o={app:0},i=[];function a(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,a),r.l=!0,r.exports}a.m=e,a.c=n,a.d=function(e,t,r){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(a.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)a.d(r,n,function(t){return e[t]}.bind(null,n));return r},a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="/";var c=window["webpackJsonp"]=window["webpackJsonp"]||[],s=c.push.bind(c);c.push=t,c=c.slice();for(var u=0;u<c.length;u++)t(c[u]);var d=s;i.push([0,"chunk-vendors"]),r()})({0:function(e,t,r){e.exports=r("56d7")},"2d49":function(e,t,r){"use strict";r("2d4f")},"2d4f":function(e,t,r){},"56d7":function(e,t,r){"use strict";r.r(t);r("44a9"),r("3a99"),r("2c238"),r("6ae4");var n=r("a593"),o=r("6255"),i=r.n(o),a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticStyle:{height:"100%"},attrs:{id:"app"}},[r("router-view")],1)},c=[],s={components:{},data:function(){return{}},methods:{}},u=s,d=r("5d22"),l=Object(d["a"])(u,a,c,!1,null,"b3c4ecce",null),p=l.exports,v=r("a81e"),f=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("div",{},[r("el-dialog",{attrs:{visible:e.showInfo,title:"输入信息"},on:{"update:visible":function(t){e.showInfo=t}}},[r("p",[e._v("用户名")]),r("el-input",{model:{value:e.userId,callback:function(t){e.userId=t},expression:"userId"}}),r("div",[r("el-button",{staticStyle:{"margin-top":"20px"},attrs:{type:"primary"},on:{click:e.joinRoom}},[e._v("加入")])],1)],1)],1),r("el-button",{attrs:{type:"primary"},on:{click:function(t){e.showInfo=!0}}},[e._v("加入房间")]),e._m(0)],1)},h=[function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"users"},[r("p",[e._v("本地视频")]),r("div",{staticStyle:{width:"500px"},attrs:{id:"localvideo"}}),r("p",[e._v("会议内容")]),r("div",{staticClass:"remote"},[r("div",{staticStyle:{width:"50%"},attrs:{id:"mobile"}}),r("div",{staticStyle:{width:"50%"},attrs:{id:"ppt"}}),r("div",{staticStyle:{width:"100%","margin-top":"50px"},attrs:{id:"meeting"}})])])}],m=(r("8601"),r("bc4a"),r("85a2"),r("1377")),b=(r("6a61"),r("2e91")),y=r("0c68"),g=r("82ae"),w=r.n(g),x=w.a.create({baseURL:"./index.php",timeout:5e3}),I=x;function S(){return I.post("./index.php",{function:"listActiveRooms"})}function k(e,t,r){return I.post("./index.php",{function:"createRoomToken",room:e,userId:t,type:r})}function R(e){return I.post("./index.php",{function:"listRoomUsers",room:e})}var j=new y["StreamModeSession"];console.log("current version is",y["version"]);var _={data:function(){return{audioDevice:"",videoDevice:"",audioDevices:[],videoDevices:[],roomToken:"",userList:[],currentUser:"",lastUser:"",showInfo:!1,showToken:!1,room:"",userId:"",userToken:"",room_list:[],type:"admin",currentRoom:""}},mounted:function(){var e=this;this.listActiveRooms(),y["deviceManager"].deviceInfo&&this.addDeviceToSelect(y["deviceManager"].deviceInfo),y["deviceManager"].on("device-update",(function(t){e.addDeviceToSelect(t)}))},methods:{addDeviceToSelect:function(e){var t=[],r=[];e.forEach((function(e){"audioinput"===e.kind?t.push(e):"videoinput"===e.kind&&r.push(e)})),this.audioDevices=t,this.videoDevices=r},joinRoom:function(){var e=this;return Object(b["a"])(regeneratorRuntime.mark((function t(){var r,n,o,i,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.createRoomToken();case 2:return r=t.sent,t.prev=3,t.next=6,j.joinRoomWithToken(r);case 6:n=t.sent,o=Object(m["a"])(n);try{for(o.s();!(i=o.n()).done;)a=i.value,a.userId!==j.userId&&a.published&&("mobile"==a.userId?e.subscribeUser(a.userId,"mobile"):"ppt"==a.userId?e.subscribeUser(a.userId,"ppt"):e.subscribeUser(a.userId,"meeting"))}catch(c){o.e(c)}finally{o.f()}t.next=16;break;case 11:return t.prev=11,t.t0=t["catch"](3),console.error(t.t0),alert("加入房间失败！ErrorCode: ".concat(t.t0.code||"")),t.abrupt("return");case 16:return j.on("user-publish",(function(t){e.subscribeUser(t.userId)})),t.next=19,e.publishScreen(j);case 19:e.listActiveRooms();case 20:case"end":return t.stop()}}),t,null,[[3,11]])})))()},publishScreen:function(){return Object(b["a"])(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,y["deviceManager"].getLocalStream({screen:{enabled:!0,source:"window",bitrate:600,height:1080,width:1920},audio:{enabled:!1}});case 3:t=e.sent,e.next=11;break;case 6:return e.prev=6,e.t0=e["catch"](0),console.error(e.t0),alert("采集失败，请检查您的设备。ErrorCode: ".concat(e.t0.code)),e.abrupt("return");case 11:return r=document.getElementById("localvideo"),t.play(r,!0),e.prev=13,e.next=16,j.publish(t);case 16:e.next=22;break;case 18:e.prev=18,e.t1=e["catch"](13),console.error(e.t1),alert("发布失败，ErrorCode: ".concat(e.t1.code));case 22:case"end":return e.stop()}}),e,null,[[0,6],[13,18]])})))()},publish:function(){var e=this;return Object(b["a"])(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,y["deviceManager"].getLocalStream({video:{enabled:!0,deviceId:e.videoDevice,bitrate:1e3,height:1080,width:1920},audio:{enabled:!0,deviceId:e.audioDevice}});case 3:r=t.sent,t.next=11;break;case 6:return t.prev=6,t.t0=t["catch"](0),console.error(t.t0),alert("采集失败，请检查您的设备。ErrorCode: ".concat(t.t0.code)),t.abrupt("return");case 11:return n=document.getElementById("localvideo"),r.play(n,!0),t.prev=13,t.next=16,j.publish(r);case 16:t.next=22;break;case 18:t.prev=18,t.t1=t["catch"](13),console.error(t.t1),alert("发布失败，ErrorCode: ".concat(t.t1.code));case 22:case"end":return t.stop()}}),t,null,[[0,6],[13,18]])})))()},subscribeUser:function(e,t){var r=document.getElementById(t);j.subscribe(e).then((function(e){e.play(r)}))},listActiveRooms:function(){var e=this;S().then((function(t){e.room_list=t.data.rooms}))},createRoomToken:function(){var e=this;return new Promise((function(t,r){k("test",e.userId,"user").then((function(e){t(e.data.data)}))}))},listRoomUsers:function(){var e=this;R("test").then((function(t){console.log(t),e.userList=t.data.users}))},chooseRoom:function(e){this.currentRoom=e,this.listRoomUsers()},changeView:function(){var e,t=Object(m["a"])(this.userList);try{for(t.s();!(e=t.n()).done;){var r=e.value;r.userId==this.currentUser?j.setMergeStreamLayout(this.currentUser,{x:0,y:0,w:1920,h:1080,hidden:!1,muted:!1}):j.setMergeStreamLayout(r.userId,{x:0,y:0,w:0,h:0,hidden:!1,muted:!1})}}catch(n){t.e(n)}finally{t.f()}},stopView:function(){j.stopMergeStream()}}},O=_,M=(r("2d49"),Object(d["a"])(O,f,h,!1,null,null,null)),T=M.exports;n["default"].use(v["a"]);var U=v["a"].prototype.push;v["a"].prototype.push=function(e){return U.call(this,e).catch((function(e){return e}))};var E=new v["a"]({routes:[{path:"/",component:T}]}),D=E,L=(r("a675"),r("9f35"),r("cf6b")),P=r("ea5a");n["default"].use(L["a"]);var C=new L["a"].Store({state:{},mutations:{},plugins:[Object(P["a"])()]}),A=C;n["default"].config.productionTip=!1,n["default"].use(i.a),new n["default"]({router:D,store:A,render:function(e){return e(p)}}).$mount("#app")}});
//# sourceMappingURL=app.18162f84.js.map